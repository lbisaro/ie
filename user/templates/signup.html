{% extends 'base.html' %}
{% block title %}Registrarse{% endblock %}
{% block nav_title %}Registrarse{% endblock %}
{% load static %}

{% block content %}

<section>
    <div class="container py-5 ">
        <div class="row d-flex justify-content-center align-items-center ">
            <div class="col-12 col-md-8 col-lg-6 col-xl-5">
                <div class="card " style="border-radius: 1rem;">
                    <div class="card-body p-5 text-center">

                        <div class="mb-md-2 mt-md-4 pb-1">
                            <h5 class="fw-bold mb-4">Registre sus datos</h5>
                    
                            <div class="form-outline mb-3">
                                <input type="text" id="first_name" placeholder="Nombre"
                                    class="form-control form-control-lg text-center" autofocus/>
                            </div>

                            <div class="form-outline mb-3">
                                <input type="text" id="last_name" placeholder="Apellido"
                                    class="form-control form-control-lg text-center" />
                            </div>

                            <div class="form-outline mb-3">
                                <input type="email" id="email" placeholder="Correo electronico"
                                    class="form-control form-control-lg text-center" />
                            </div>

                            <div class="form-outline mb-3">
                                <input type="text" id="username" placeholder="Nombre de usuario"
                                    class="form-control form-control-lg text-center" />
                            </div>

                            <div class="form-outline mb-3">
                                <input type="password" id="password1" placeholder="Contraseña"
                                    class="form-control form-control-lg text-center" />
                            </div>

                            <div class="form-outline mb-3">
                                <input type="password" id="password2" placeholder="Repita la contraseña"
                                    class="form-control form-control-lg text-center" />
                            </div>

                            <div id="signup_msg" class="form-outline mb-4">
                            </div>

                            <div class="form-outline mb-4 mt-4 d-grid gap-2">
                                <button class="btn btn-primary btn-lg btn-block "
                                    onclick="signup()">Registrarse</button>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block css %}
<style>
.error_msg ul li {
    list-style:none;

}

</style>
{% endblock %}
{% block script %}
<script>
function signup() {
    signup_msg('Aguarde...', 'text-secondary');
    $.ajax({
        type: 'POST',
        url: '{% url "signup" %}',
        data: {
            first_name: $('#first_name').val(),
            last_name: $('#last_name').val(),
            email: $('#email').val(),
            username: $('#username').val(),
            password1: $('#password1').val(),
            password2: $('#password2').val(),
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
            action: 'post'
        },
        success: function (json) {
            if (json.error)
            {
                signup_msg(json.error, 'text-danger')
            }
            else if (json.ok)
            {
                signup_msg(json.ok, 'text-success');
                location.href = '{% url "signin" %}'
            }


        },
        error: function (xhr, errmsg, err) {
            console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
        }
    });

}

function signup_msg(text, cls) {
    var html = '<span class="' + cls + ' text-left error_msg">' + text + '</span>';
    $("#signup_msg").html(html);
}
</script>
{% endblock %}