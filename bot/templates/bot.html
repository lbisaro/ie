{% extends 'base.html' %}
{% block title %}Bot {{title}}{% endblock %}
{% block nav_title %}Bot{% endblock %}

{% load static %}

{% block action_bar %}

<a class="btn btn-primary  btn-sm" href="{% url 'bot_edit' bot_id %}">Editar Bot</a>
{% if activo > 0 %}
    <a class="btn btn-danger  btn-sm" href="{% url 'bot_toogle_activo' bot_id %}">Desactivar</a>
{% elif can_activar %}
    <a class="btn btn-success  btn-sm" href="{% url 'bot_toogle_activo' bot_id %}">Activar</a>
{% endif %}
{% if can_delete %}
    <button class="btn btn-danger  btn-sm" onclick="eliminar()">Eliminar</a>
{% endif %}

{% endblock %}

{% block content %}
<div class="container">
    <div class="row pb-2">
        <div class="col-2">Estrategia:  
        <span class="col fw-bold">{{estrategia}}</span> 
        {% if estrategia_activo == 0%} <span class="text-danger">Inactiva</span>{% endif %}
    </div>
    <div class="row pb-2">                                  
        <pre style="font-family: inherit;">{{descripcion}}</pre>                                    
    </div>
    {% if activo == 0 %}
    <div class="row pb-2">
        <h3 class="text-danger text-center">Bot inactivo</h3>
    </div>
    {% endif %}
    <!--
    <div class="row">

        <div class="d-flex flex-row flex-wrap rounded border border-1 pb-2 mb-1">
            <pre class="py-2" style="font-family: inherit;">{{descripcion}}</pre>
            
            <div class="w-50 py-2">Intervalo: <b>{{intervalo}}</b></div>
            
            {% for k,prm in parametros.items %}
                {% if prm.pub %}
                    
                
                    <div class="w-50 py-2">{{prm.d}}: <b>{{prm.str}}</b></div>
                    
                {% endif %}
            {% endfor %}
            
            
        </div>

    </div>
    
-->
    <div class="row pb-4">
        <div class="col-4">Capital USD: <b>{{quote_qty}}</b></div>                                    
        <div class="col-4">Stop Loss General: <b>{{stop_loss}} %</b></div>
        <div class="col-4">Maximo DrowDawn: <b>{{max_drawdown}} %</b></div>                                   
    </div>


    <div class="container  pb-2" id="run" style="display:none;">
        {% include 'trade_results.html' %}
    </div>
    <div class="row text-secondary">
        <div class="col">Creado {{creado}}</div>                                    
    </div>
</div>

<input type="hidden" id="bot_id" value="{bot_id}" >

{% endblock %}

{% block script %}
<script>

$(document).ready( function () {
    get_resultados()
})
function get_resultados() {
    url = '{% url "get_resultados" bot_id %}';
    console.log(url);
        
    get_ajax(url).done( function (rsp) {
        if (rsp.error)
        {
            html_alert('Errores detectados',rsp.error,'text-danger')
        }
        else if (rsp.ok)
        {
            data = rsp.bt.data
            timeUnit = 'minute';
            if (rsp.parametros.interval_id.substring(1, 2) == 'd')
                timeUnit = 'day';
            else if (rsp.parametros.interval_id.substring(1, 2) == 'h')
                timeUnit = 'hour';
            
            chartDraw(data, rsp.parametros.symbol, timeUnit )
            infoDraw(rsp.bt);
            $('#run').show();
                        
        }
    });    
}

function eliminar()
{
    if (confirm('Confirma eliminar el bot {{nombre}}?'))
    {
        url = "{% url 'bot_delete' bot_id %}"
        data = null
        get_ajax(url,data).done( function (rsp) {
            if (rsp.error)
                html_alert('Errores detectados',rsp.error,'text-danger')
            if (rsp.ok)
            {
                location.href = "{% url 'bots' %}";
            }
        });    

        
    }
}


</script>

{% endblock %}