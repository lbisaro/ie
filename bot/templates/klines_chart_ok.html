<!-- Styles -->
<style>
    #chartdiv {
        width: 100%;
        height: 600px;
        max-width: 100%;
    }
</style>

<!-- Resources -->
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Dark.js"></script>

<!-- Chart code -->
<script>

    var root
    am5.ready(function () {
        root = am5.Root.new("chartdiv");
    });

    function chartDraw(data, symbol, timeUnit) {
        root.dispose();
        root = am5.Root.new("chartdiv");
        root.setThemes([
            am5themes_Dark.new(root)
        ]);

        root.numberFormatter.set("numberFormat", "#,###.#########");

        var chart = root.container.children.push(
            am5xy.XYChart.new(root, {
                panX: true,
                panY: false,
                wheelX: "panX",
                wheelY: "zoomX",
                layout: root.verticalLayout,
                pinchZoomX: true,
            })
        );

        // Create Y-axis
        var yAxis = chart.yAxes.push(
            am5xy.ValueAxis.new(root, {
                renderer: am5xy.AxisRendererY.new(root, {
                    minGridDistance: 100,
                })
            })
        );



        // Create X-Axis
        var xAxis = chart.xAxes.push(
            am5xy.DateAxis.new(root, {
                baseInterval: { timeUnit: timeUnit, count: 1 },
                renderer: am5xy.AxisRendererX.new(root, {
                    minGridDistance: 100
                }),
            })
        );



        // Create series OHLC ----------------------------------------------------------------------
        var series = chart.series.push(
            am5xy.CandlestickSeries.new(root, {
                name: symbol,
                xAxis: xAxis,
                yAxis: yAxis,
                openValueYField: "o",
                highValueYField: "h",
                lowValueYField: "l",
                valueYField: "c",
                valueXField: "dt",
            })
        );

        series.columns.template.states.create("riseFromOpen", {
            fill: am5.color(0x9a5760),
            stroke: am5.color(0x9a5760)
        });
        series.columns.template.states.create("dropFromOpen", {
            fill: am5.color(0x318866),
            stroke: am5.color(0x318866)
        });

        series.columns.template.setAll({
            width: am5.percent(40),
        });
        series.data.setAll(data);


        



        // Create series Buy Order ----------------------------------------------------------------------
        // https://www.amcharts.com/docs/v5/charts/xy-chart/series/
        var seriesBuy = chart.series.push(am5xy.LineSeries.new(root, {
            calculateAggregates: true,
            xAxis: xAxis,
            yAxis: yAxis,
            fill: am5.color(0x0ecb81),
            valueYField: "buy",
            valueXField: "dt",
            valueField: "flag",
            tooltip: am5.Tooltip.new(root, {
                labelText: "{value} Buy - Price {valueY}"
            })
        }));

        // Add bullet
        // https://www.amcharts.com/docs/v5/charts/xy-chart/series/#Bullets
        var circleTemplate = am5.Template.new({});
        seriesBuy.bullets.push(function () {
            var graphics = am5.Circle.new(root, {
                fill: null,
                stroke: am5.color(0x0ecb81),
            }, circleTemplate);
            return am5.Bullet.new(root, {
                sprite: graphics
            });
        });

        seriesBuy.strokes.template.set("strokeOpacity", 0);
        seriesBuy.data.setAll(data);


        // Create series Sell Order ----------------------------------------------------------------------
        // https://www.amcharts.com/docs/v5/charts/xy-chart/series/
        var seriesSell = chart.series.push(am5xy.LineSeries.new(root, {
            calculateAggregates: true,
            xAxis: xAxis,
            yAxis: yAxis,
            fill: am5.color(0xf6465d),
            valueYField: "sell",
            valueXField: "dt",
            valueField: "flag",
            tooltip: am5.Tooltip.new(root, {
                labelText: "{value} Sell - Price {valueY}"
            })
        }));
        // Add bullet
        // https://www.amcharts.com/docs/v5/charts/xy-chart/series/#Bullets
        var circleTemplate = am5.Template.new({});
        seriesSell.bullets.push(function () {
            var graphics = am5.Circle.new(root, {
                fill: null,
                stroke: am5.color(0xf6465d),
            }, circleTemplate);
            return am5.Bullet.new(root, {
                sprite: graphics
            });
        });
        seriesSell.strokes.template.set("strokeOpacity", 0);
        seriesSell.data.setAll(data);





        //Barra de desplazamiento
        chart.set("scrollbarX", am5.Scrollbar.new(root, { orientation: "horizontal" }));


        //Cursores
        chart.set("cursor", am5xy.XYCursor.new(root, {
            behavior: "zoomXY",
            xAxis: xAxis
        }));

        xAxis.set("tooltip", am5.Tooltip.new(root, {
            themeTags: ["axis"]
        }));

        yAxis.set("tooltip", am5.Tooltip.new(root, {
            themeTags: ["axis"]
        }));











    };

</script>

<div id="chartdiv"></div>